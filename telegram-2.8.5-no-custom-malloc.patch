diff -up tdesktop-3.1.5-full/cmake/external/CMakeLists.txt.2~ tdesktop-3.1.5-full/cmake/external/CMakeLists.txt
--- tdesktop-3.1.5-full/cmake/external/CMakeLists.txt.2~	2021-10-04 14:50:25.000000000 +0200
+++ tdesktop-3.1.5-full/cmake/external/CMakeLists.txt	2021-10-04 14:53:57.278436800 +0200
@@ -37,9 +37,6 @@ if (add_hunspell_library)
 	add_checked_subdirectory(hunspell)
 endif()
 add_checked_subdirectory(iconv)
-if (LINUX)
-    add_checked_subdirectory(jemalloc)
-endif()
 add_checked_subdirectory(jpeg)
 if (LINUX AND NOT DESKTOP_APP_DISABLE_WAYLAND_INTEGRATION)
     add_checked_subdirectory(kwayland)
diff -up tdesktop-3.1.5-full/cmake/external/jemalloc/CMakeLists.txt.2~ tdesktop-3.1.5-full/cmake/external/jemalloc/CMakeLists.txt
--- tdesktop-3.1.5-full/cmake/external/jemalloc/CMakeLists.txt.2~	2021-10-04 14:53:57.279436821 +0200
+++ tdesktop-3.1.5-full/cmake/external/jemalloc/CMakeLists.txt	2021-10-04 15:11:11.703131952 +0200
@@ -1,68 +0,0 @@
-# This file is part of Desktop App Toolkit,
-# a set of libraries for developing nice desktop applications.
-#
-# For license and copyright information please follow this link:
-# https://github.com/desktop-app/legal/blob/master/LEGAL
-
-add_library(external_jemalloc INTERFACE IMPORTED GLOBAL)
-add_library(desktop-app::external_jemalloc ALIAS external_jemalloc)
-
-if (CMAKE_SYSTEM_NAME STREQUAL "FreeBSD")
-    return()
-endif()
-
-if (DESKTOP_APP_USE_PACKAGED)
-    find_package(PkgConfig REQUIRED)
-    pkg_check_modules(JEMALLOC IMPORTED_TARGET jemalloc)
-
-    if (JEMALLOC_FOUND)
-        target_link_libraries(external_jemalloc
-        INTERFACE
-            -Wl,--no-as-needed
-            PkgConfig::JEMALLOC
-            ${JEMALLOC_LINK_LIBRARIES}
-            -Wl,--as-needed
-        )
-    endif()
-endif()
-
-if (NOT JEMALLOC_FOUND)
-    add_library(external_jemalloc_bundled STATIC IMPORTED GLOBAL)
-    set(jemalloc_loc ${third_party_loc}/jemalloc)
-
-    include(ExternalProject)
-    ExternalProject_Add(jemalloc
-        SOURCE_DIR ${jemalloc_loc}
-        CONFIGURE_COMMAND cd "${jemalloc_loc}" && export EXTRA_CFLAGS=-fstack-protector-all\ -fPIC\ -D_FORTIFY_SOURCE=2 && export EXTRA_CXXFLAGS=-fstack-protector-all\ -fPIC\ -D_FORTIFY_SOURCE=2 && CC=clang CXX=clang++ ./autogen.sh
-        INSTALL_COMMAND :
-        BUILD_IN_SOURCE 1
-        BUILD_BYPRODUCTS ${jemalloc_loc}/lib/libjemalloc.a
-    )
-
-    file(MAKE_DIRECTORY "${jemalloc_loc}/include")
-
-    set_target_properties(external_jemalloc_bundled PROPERTIES
-        IMPORTED_LOCATION "${jemalloc_loc}/lib/libjemalloc.a"
-    )
-
-    target_include_directories(external_jemalloc_bundled SYSTEM
-    INTERFACE
-        ${jemalloc_loc}/include
-    )
-
-    target_link_libraries(external_jemalloc_bundled
-    INTERFACE
-        ${CMAKE_DL_LIBS}
-        pthread
-    )
-
-    add_dependencies(external_jemalloc_bundled jemalloc)
-
-    target_link_libraries(external_jemalloc
-    INTERFACE
-        -Wl,--whole-archive
-        $<TARGET_FILE:external_jemalloc_bundled>
-        -Wl,--no-whole-archive
-        external_jemalloc_bundled
-    )
-endif()
diff -up tdesktop-3.1.5-full/cmake/options_linux.cmake.2~ tdesktop-3.1.5-full/cmake/options_linux.cmake
--- tdesktop-3.1.5-full/cmake/options_linux.cmake.2~	2021-10-04 14:50:25.000000000 +0200
+++ tdesktop-3.1.5-full/cmake/options_linux.cmake	2021-10-04 14:53:57.279436821 +0200
@@ -52,10 +52,10 @@ if (DESKTOP_APP_SPECIAL_TARGET)
     target_link_options(common_options INTERFACE $<IF:$<CONFIG:Debug>,,-g -flto -fuse-linker-plugin>)
 endif()
 
-target_link_libraries(common_options
-INTERFACE
-    desktop-app::external_jemalloc
-)
+#target_link_libraries(common_options
+#INTERFACE
+#    desktop-app::external_jemalloc
+#)
 
 if (DESKTOP_APP_USE_ALLOCATION_TRACER)
     target_link_options(common_options
diff -up tdesktop-3.1.5-full/Telegram/SourceFiles/platform/linux/specific_linux.cpp.2~ tdesktop-3.1.5-full/Telegram/SourceFiles/platform/linux/specific_linux.cpp
--- tdesktop-3.1.5-full/Telegram/SourceFiles/platform/linux/specific_linux.cpp.2~	2021-10-04 14:47:25.000000000 +0200
+++ tdesktop-3.1.5-full/Telegram/SourceFiles/platform/linux/specific_linux.cpp	2021-10-04 14:53:57.279436821 +0200
@@ -47,12 +47,6 @@ https://github.com/telegramdesktop/tdesk
 
 #include <private/qguiapplication_p.h>
 
-#ifdef Q_OS_FREEBSD
-#include <malloc_np.h>
-#else // Q_OS_FREEBSD
-#include <jemalloc/jemalloc.h>
-#endif // Q_OS_FREEBSD
-
 #ifndef DESKTOP_APP_DISABLE_DBUS_INTEGRATION
 #include <glibmm.h>
 #include <giomm.h>
@@ -662,7 +656,6 @@ namespace Platform {
 
 void start() {
 	auto backgroundThread = true;
-	mallctl("background_thread", nullptr, nullptr, &backgroundThread, sizeof(bool));
 
 	// Prevent any later calls into setlocale() by Qt
 	QCoreApplicationPrivate::initLocale();
